{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the Danny Store application.",
      "properties": {
        "displayName": {
          "type": "string",
          "description": "User's display name."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "language": {
          "type": "string",
          "description": "User's preferred language (en, fr, ht)."
        },
        "phoneWhatsApp": {
          "type": "string",
          "description": "User's WhatsApp phone number."
        },
        "consentWhatsApp": {
          "type": "boolean",
          "description": "Indicates if the user has consented to be contacted via WhatsApp."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the user account was created.",
          "format": "date-time"
        },
        "lastLoginAt": {
          "type": "string",
          "description": "Timestamp of the user's last login.",
          "format": "date-time"
        },
        "isAdmin": {
          "type": "boolean",
          "description": "Indicates if the user is a super administrator."
        },
        "roles": {
          "type": "array",
          "description": "List of roles assigned to the user.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "displayName",
        "email",
        "language",
        "phoneWhatsApp",
        "consentWhatsApp",
        "createdAt",
        "lastLoginAt"
      ]
    },
    "Role": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Role",
      "type": "object",
      "description": "Represents a role with associated permissions.",
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the role."
        },
        "permissions": {
          "type": "array",
          "description": "List of permissions associated with the role.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "name",
        "permissions"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product in the Danny Store catalog.",
      "properties": {
        "slug": {
          "type": "string",
          "description": "Unique slug for the product (used in URLs)."
        },
        "title": {
          "type": "object",
          "description": "Localized title of the product.",
          "properties": {
            "en": { "type": "string" },
            "fr": { "type": "string" },
            "ht": { "type": "string" }
          }
        },
        "descriptions": {
          "type": "object",
          "description": "Localized description for the product.",
           "properties": {
            "en": { "type": "string" },
            "fr": { "type": "string" },
            "ht": { "type": "string" }
          }
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "compareAtPrice": {
          "type": "number",
          "description": "Original price of the product (used for displaying discounts)."
        },
        "images": {
          "type": "array",
          "description": "List of image URLs for the product.",
          "items": {
            "type": "string"
          }
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category. (Relationship: Category 1:N Product)"
        },
        "tags": {
          "type": "array",
          "description": "List of tags associated with the product.",
          "items": {
            "type": "string"
          }
        },
        "variants": {
          "type": "array",
          "description": "List of product variants (color, size, etc.).",
           "items": {
            "type": "object",
            "properties": {
              "id": {"type": "string"},
              "color": {"type": "string"},
              "size": {"type": "string"},
              "price": {"type": "number"},
              "sku": {"type": "string"},
              "stock": {"type": "number"}
            },
            "required": ["id", "color", "size", "stock"]
          }
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the product is currently active and visible."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the product was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp of when the product was last updated.",
          "format": "date-time"
        },
        "ratingAvg": {
          "type": "number",
          "description": "Average rating of the product."
        },
        "ratingCount": {
          "type": "number",
          "description": "Number of ratings for the product."
        }
      },
      "required": [
        "slug",
        "title",
        "descriptions",
        "price",
        "images",
        "categoryId",
        "variants",
        "isActive",
        "createdAt",
        "updatedAt"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a product category.",
      "properties": {
        "slug": {
          "type": "string",
          "description": "Unique slug for the category (used in URLs)."
        },
        "name": {
          "type": "object",
          "description": "Localized name of the category.",
           "properties": {
            "en": { "type": "string" },
            "fr": { "type": "string" },
            "ht": { "type": "string" }
          }
        },
        "order": {
          "type": "number",
          "description": "Order of the category in the category list."
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the category is currently active and visible."
        },
        "attributesConfig": {
          "type": "string",
          "description": "JSON configuration for customizable category attributes (sizes, colors, filters)."
        }
      },
      "required": [
        "slug",
        "name",
        "order",
        "isActive"
      ]
    },
    "Collection": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Collection",
      "type": "object",
      "description": "Represents a collection of products.",
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the collection."
        },
        "productIds": {
          "type": "array",
          "description": "References to Products. (Relationship: Collection N:N Product)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "name",
        "productIds"
      ]
    },
    "Page": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Page",
      "type": "object",
      "description": "Represents a CMS page (about, FAQ, legal).",
      "properties": {
        "title": {
          "type": "string",
          "description": "Title of the page."
        },
        "content": {
          "type": "string",
          "description": "Content of the page (HTML or markdown)."
        }
      },
      "required": [
        "title",
        "content"
      ]
    },
    "SiteSetting": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SiteSetting",
      "type": "object",
      "description": "Represents global site settings.",
      "properties": {
        "themeTokens": {
          "type": "string",
          "description": "Theme tokens (light/dark)."
        },
        "socialLinks": {
          "type": "object",
          "description": "Social media links."
        },
        "whatsappSupportNumber": {
          "type": "string",
          "description": "WhatsApp support phone number."
        },
        "languagesEnabled": {
          "type": "array",
          "items": { "type": "string" }
        },
        "seoDefaults": {
          "type": "object",
          "description": "Default SEO settings."
        },
        "featureFlags": {
          "type": "object",
          "description": "Feature flags."
        }
      },
      "required": [
        "whatsappSupportNumber",
        "languagesEnabled"
      ]
    },
    "Cart": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Cart",
      "type": "object",
      "description": "Represents a user's shopping cart.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 Cart)"
        },
        "items": {
          "type": "array",
          "description": "List of items in the cart.",
          "items": { "type": "object" }
        }
      },
      "required": [
        "userId",
        "items"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer order.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Order)"
        },
        "items": {
          "type": "array",
          "description": "List of items in the order.",
          "items": {
            "type": "object",
            "properties": {
                "productId": { "type": "string" },
                "variantId": { "type": "string" },
                "titleSnapshot": { "type": "string" },
                "imageSnapshot": { "type": "string" },
                "color": { "type": "string" },
                "size": { "type": "string" },
                "qty": { "type": "number" },
                "unitPrice": { "type": "number" }
            }
          }
        },
        "subtotal": {
          "type": "number",
          "description": "Subtotal of the order."
        },
        "total": {
          "type": "number",
          "description": "Total amount of the order."
        },
        "currency": {
          "type": "string",
          "description": "Currency of the order."
        },
        "status": {
          "type": "string",
          "description": "Status of the order.",
          "enum": ["pending", "confirmed", "processing", "shipped", "delivered", "cancelled"]
        },
        "checkoutMethod": {
          "type": "string",
          "description": "Checkout method used (whatsapp, other)."
        },
        "customerWhatsApp": {
          "type": "string",
          "description": "Customer's WhatsApp number used for the order."
        },
        "language": {
          "type": "string",
          "description": "Language used for the order (en, fr, ht)."
        },
        "provisionalWhatsAppMessage": {
          "type": "string",
          "description": "Provisional WhatsApp message generated for the order."
        },
        "deliveryNote": {
          "type": "string",
          "description": "Delivery note for the order."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the order was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp of when the order was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "userId",
        "items",
        "subtotal",
        "total",
        "currency",
        "status",
        "checkoutMethod",
        "customerWhatsApp",
        "language",
        "deliveryNote",
        "createdAt",
        "updatedAt"
      ]
    },
    "OrderEvent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderEvent",
      "type": "object",
      "description": "Represents an event in the lifecycle of an order.",
      "properties": {
        "type": {
          "type": "string",
          "description": "Type of event (e.g., status change)."
        },
        "message": {
          "type": "string",
          "description": "Message associated with the event."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the event occurred.",
          "format": "date-time"
        },
        "actor": {
          "type": "string",
          "description": "Actor who triggered the event (admin/user)."
        }
      },
      "required": [
        "type",
        "message",
        "createdAt",
        "actor"
      ]
    },
    "Review": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Review",
      "type": "object",
      "description": "Represents a product review.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Review)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Review)"
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N Review)"
        },
        "rating": {
          "type": "number",
          "description": "Rating given by the user (1-5)."
        },
        "text": {
          "type": "object",
           "properties": {
            "en": { "type": "string" },
            "fr": { "type": "string" },
            "ht": { "type": "string" }
          }
        },
        "status": {
          "type": "string",
          "description": "Status of the review (published, hidden, pending)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the review was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp of when the review was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "userId",
        "productId",
        "rating",
        "status",
        "createdAt",
        "updatedAt"
      ]
    },
    "SurveyPrompt": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SurveyPrompt",
      "type": "object",
      "description": "Represents a survey prompt displayed to the user after an order is delivered.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Reference to User."
        },
        "status": {
          "type": "string",
          "description": "Status of the survey (idle, snoozed, submitted)."
        },
        "shownOnce": {
          "type": "boolean",
          "description": "Indicates if the survey has been shown to the user once."
        },
        "reshowAt": {
          "type": "string",
          "description": "Timestamp of when the survey should be shown again if snoozed.",
          "format": "date-time"
        },
        "submittedAt": {
          "type": "string",
          "description": "Timestamp of when the survey was submitted.",
          "format": "date-time"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the survey prompt was created.",
          "format": "date-time"
        }
      },
      "required": [
        "userId",
        "status",
        "shownOnce",
        "createdAt"
      ]
    },
    "TryonUsage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TryonUsage",
      "type": "object",
      "description": "Represents the usage of virtual try-on feature for a user on a specific day.",
      "properties": {
        "usedCount": {
          "type": "number",
          "description": "Number of try-on requests used on the specified date."
        },
        "limit": {
          "type": "number",
          "description": "Maximum number of try-on requests allowed per day (default 5)."
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp of when the try-on usage was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "usedCount",
        "limit",
        "updatedAt"
      ]
    },
    "TryonRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TryonRequest",
      "type": "object",
      "description": "Represents a request for a virtual try-on.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N TryonRequest)"
        },
        "avatarId": {
          "type": "string",
          "description": "Identifier of the avatar used for the try-on."
        },
        "itemsSnapshot": {
          "type": "array",
          "items": { "type": "object" },
          "description": "Snapshot of the items used for the try-on."
        },
        "userPhotoUrl": {
          "type": "string",
          "description": "URL of the user's photo used for the try-on.",
          "format": "uri"
        },
        "status": {
          "type": "string",
          "description": "Status of the try-on request (queued, processing, done, error)."
        },
        "resultImageUrl": {
          "type": "string",
          "description": "URL of the resulting image after the try-on is processed.",
          "format": "uri"
        },
        "errorMessage": {
          "type": "string",
          "description": "Error message if the try-on request failed."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the try-on request was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp of when the try-on request was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "userId",
        "itemsSnapshot",
        "status",
        "createdAt",
        "updatedAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "google.com",
      "apple.com",
      "facebook.com"
    ]
  },
  "firestore": {
    "/users/{userId}": {
      "schema": { "$ref": "#/entities/User" },
      "description": "Stores user profiles. Only the user can read/write their own document (except admin fields)."
    },
    "/roles/{roleId}": {
      "schema": { "$ref": "#/entities/Role" },
      "description": "Stores role definitions (name, permissions[]). Accessible to super admins only."
    },
    "/products/{productId}": {
      "schema": { "$ref": "#/entities/Product" },
      "description": "Stores product information. Public read for active products. Admin write access."
    },
    "/categories/{categoryId}": {
      "schema": { "$ref": "#/entities/Category" },
      "description": "Stores product categories. Public read. Admin write access."
    },
    "/collections/{collectionId}": {
      "schema": { "$ref": "#/entities/Collection" },
      "description": "Stores collections of products. Public read. Admin write access."
    },
    "/pages/{pageId}": {
      "schema": { "$ref": "#/entities/Page" },
      "description": "Stores CMS pages (about, FAQ, legal). Public read. Admin write access."
    },
    "/siteSettings/global": {
      "schema": { "$ref": "#/entities/SiteSetting" },
      "description": "Stores global site settings. Public read. Admin write access."
    },
    "/carts/{userId}": {
      "schema": { "$ref": "#/entities/Cart" },
      "description": "Stores user's shopping cart. The user can read/write their own cart."
    },
    "/orders/{orderId}": {
      "schema": { "$ref": "#/entities/Order" },
      "description": "Stores customer orders. User can read their own orders. Write access only via server."
    },
    "/orderEvents/{orderId}/events/{eventId}": {
      "schema": { "$ref": "#/entities/OrderEvent" },
      "description": "Stores events related to an order. Write access only via server."
    },
    "/reviews/{reviewId}": {
      "schema": { "$ref": "#/entities/Review" },
      "description": "Stores product reviews. Public read only for published reviews. User can write their own reviews."
    },
    "/surveyPrompts/{orderId}": {
      "schema": { "$ref": "#/entities/SurveyPrompt" },
      "description": "Stores survey prompts post-delivery. Write access via server."
    },
    "/tryonUsage/{userId}/days/{YYYYMMDD}": {
      "schema": { "$ref": "#/entities/TryonUsage" },
      "description": "Tracks daily usage of the virtual try-on feature. Write access via server."
    },
    "/tryonRequests/{requestId}": {
      "schema": { "$ref": "#/entities/TryonRequest" },
      "description": "Stores virtual try-on requests. User can read their own requests. Write access via server."
    }
  }
}
