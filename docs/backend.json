{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Danny Store e-commerce platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "googleId": {
          "type": "string",
          "description": "User ID from Google authentication provider, if applicable."
        },
        "facebookId": {
          "type": "string",
          "description": "User ID from Facebook authentication provider, if applicable."
        },
        "appleId": {
          "type": "string",
          "description": "User ID from Apple authentication provider, if applicable."
        },
        "whatsappNumber": {
          "type": "string",
          "description": "User's WhatsApp number for order updates and communication.",
          "format": "string"
        },
        "preferredLanguage": {
          "type": "string",
          "description": "User's preferred language (FR, EN, Krey√≤l).",
          "format": "string"
        }
      },
      "required": [
        "id",
        "whatsappNumber"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product available in the Danny Store catalog.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "shortDescription": {
          "type": "string",
          "description": "Short description of the product."
        },
        "longDescription": {
          "type": "string",
          "description": "Long description of the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "category": {
          "type": "string",
          "description": "Category of the product (e.g., clothing, shoes, accessories, tech-style)."
        },
        "averageRating": {
          "type": "number",
          "description": "Average rating of the product based on customer reviews."
        },
        "numberOfReviews": {
          "type": "number",
          "description": "Number of reviews for the product."
        }
      },
      "required": [
        "id",
        "name",
        "shortDescription",
        "imageUrl",
        "category"
      ]
    },
    "ProductVariant": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ProductVariant",
      "type": "object",
      "description": "Represents a specific variant of a product (e.g., color, size).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product variant."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N ProductVariant)"
        },
        "color": {
          "type": "string",
          "description": "Color of the product variant."
        },
        "size": {
          "type": "string",
          "description": "Size of the product variant."
        },
        "price": {
          "type": "number",
          "description": "Price of the product variant."
        },
        "promoPrice": {
          "type": "number",
          "description": "Promotional price of the product variant, if applicable."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product variant image.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "productId",
        "color",
        "size",
        "price"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date and time when the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        },
        "status": {
          "type": "string",
          "description": "Status of the order (e.g., pending, processing, shipped, delivered)."
        }
      },
      "required": [
        "id",
        "userId",
        "orderDate",
        "totalAmount",
        "status"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order item."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "productVariantId": {
          "type": "string",
          "description": "Reference to ProductVariant. (Relationship: ProductVariant 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product variant in the order item."
        },
        "price": {
          "type": "number",
          "description": "Price of the product variant at the time of the order."
        }
      },
      "required": [
        "id",
        "orderId",
        "productVariantId",
        "quantity",
        "price"
      ]
    },
    "ProductReview": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ProductReview",
      "type": "object",
      "description": "Represents a customer review for a product.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product review."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N ProductReview)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N ProductReview)"
        },
        "rating": {
          "type": "number",
          "description": "Rating given by the user for the product (1-5)."
        },
        "comment": {
          "type": "string",
          "description": "Comment provided by the user about the product."
        },
        "reviewDate": {
          "type": "string",
          "description": "Date and time when the review was submitted.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "productId",
        "rating",
        "reviewDate"
      ]
    },
    "VirtualTryOnSession": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "VirtualTryOnSession",
      "type": "object",
      "description": "Represents a user's virtual try-on session and its usage.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the try-on session."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N VirtualTryOnSession)"
        },
        "sessionDate": {
          "type": "string",
          "description": "Date and time when the try-on session started.",
          "format": "date-time"
        },
        "tryonCount": {
          "type": "number",
          "description": "Number of try-on attempts during the session."
        }
      },
      "required": [
        "id",
        "userId",
        "sessionDate",
        "tryonCount"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "user",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Path-based ownership. All documents are owned by the user with ID {userId}.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product catalog information.  This collection is publicly readable.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}/variants/{variantId}",
        "definition": {
          "entityName": "productVariant",
          "schema": {
            "$ref": "#/backend/entities/ProductVariant"
          },
          "description": "Stores product variants for a specific product.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier for the product."
            },
            {
              "name": "variantId",
              "description": "The unique identifier for the product variant."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores order information for each user. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "orderId",
              "description": "The unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/orders/{orderId}/items/{itemId}",
        "definition": {
          "entityName": "orderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Stores items within an order.",
          "params": [
            {
              "name": "orderId",
              "description": "The unique identifier for the order."
            },
            {
              "name": "itemId",
              "description": "The unique identifier for the order item."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}/reviews/{reviewId}",
        "definition": {
          "entityName": "productReview",
          "schema": {
            "$ref": "#/backend/entities/ProductReview"
          },
          "description": "Stores product reviews.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier for the product."
            },
            {
              "name": "reviewId",
              "description": "The unique identifier for the product review."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/tryon_sessions/{sessionId}",
        "definition": {
          "entityName": "virtualTryOnSession",
          "schema": {
            "$ref": "#/backend/entities/VirtualTryOnSession"
          },
          "description": "Stores virtual try-on sessions.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "sessionId",
              "description": "The unique identifier for the try-on session."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure security, scalability, and ease of debugging, following the principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters). Authorization Independence is achieved through denormalization of authorization data.  Specifically, any data that requires authorization based on parent document attributes will have those attributes copied into the child documents, eliminating the need for `get()` calls in security rules.\n\n**Data Structure Justification:**\n\n*   `/users/{userId}`: Stores user profiles. Ensures private data is stored under path-based ownership, enabling easy-to-write security rules.\n*   `/products/{productId}`: Stores product catalog information.  This collection does not contain user-specific data and thus has simpler security rules.\n*   `/products/{productId}/variants/{variantId}`: Stores product variants. Located as a subcollection to maintain the relationship to products.\n*   `/users/{userId}/orders/{orderId}`: Stores order information for each user, continuing hierarchical path structure for user-owned data. This enables easy enforcement of ownership.\n*   `/orders/{orderId}/items/{itemId}`:  Stores order items, nested under orders to represent the order-item relationship.\n*   `/products/{productId}/reviews/{reviewId}`: Stores product reviews, nested under products, for easy access to reviews for a specific product.\n*   `/users/{userId}/tryon_sessions/{sessionId}`: Stores virtual try-on session data, nested under users.\n\n**Authorization Independence (Denormalization):**\n\n*   Subcollections such as `orders` and `productReviews` are structured under `/users/{userId}` or `/products/{productId}`, respectively. This allows security rules to easily validate the `userId` or `productId` against `request.auth.uid` without needing to read parent documents.\n\n**QAPs (Rules are not Filters):**\n\n*   The segregation of user-specific data into `/users/{userId}` subcollections ensures that list operations are secure.  For example, listing orders is done within the user's own collection, preventing unauthorized access to other users' order data.\n*   Publicly accessible collections like `/products` enable listing products without complex filtering rules, as all documents in this collection share the same access requirements.\n\nThe design avoids complex nested `get()` calls within security rules by denormalizing authorization context where needed, ensuring that security rules remain simple, efficient, and debuggable. Each collection is designed with a homogeneous security posture, making the security rules easier to reason about and maintain."
  }
}