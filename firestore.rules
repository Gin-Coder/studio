rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Default security rule: Deny all reads and writes.
    // This is not explicitly needed as rules are deny-by-default, but good for clarity.
    match /{document=**} {
      allow read, write: if false;
    }

    // Publicly readable collections for the storefront
    match /products/{productId} {
      allow get: if true;
    }
    match /products/{productId}/{subcollection=**} {
       allow read: if true;
    }

    match /categories/{categoryId} {
      allow read: if true;
    }
     match /categories/{categoryId}/{subcollection=**} {
      allow read: if true;
    }

    match /subcategories/{subcategoryId} {
      allow read: if true;
    }
    match /subcategories/{subcategoryId}/{subcollection=**} {
       allow read: if true;
    }
    
    // Authenticated access for admin panel operations
    // This single rule covers reads and writes for all collections for logged-in users.
    // It is simpler and less error-prone than per-collection rules for the admin section.
    match /{path=**} {
      allow read, write: if request.auth != null;
    }
  }
}
