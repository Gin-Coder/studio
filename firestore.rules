
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // == Helper Functions ==
    // This function now checks for a specific, hardcoded admin UID.
    // This is a direct and guaranteed way to grant admin access to the specified user.
    function isAdmin() {
      return request.auth.uid == 'rJ7tKCMSWjaaUJckNw5Air1muMp2';
    }

    // == Public Collections ==
    // Anyone can read products, categories, and subcategories. Only admins can write to them.
    match /products/{productId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    match /categories/{categoryId} {
      allow read: if true;
      allow write: if isAdmin();
    }
    
    match /subcategories/{subcategoryId} {
      allow read: if true;
      allow write: if isAdmin();
    }
    
    // == Admin & User-Specific Collections ==
    match /users/{userId} {
      // LIST: This is the critical rule. Only an admin can list all users.
      allow list: if isAdmin();
      
      // GET: An admin OR the user themself can read a specific user profile.
      allow get: if isAdmin() || request.auth.uid == userId;
      
      // UPDATE: An admin OR the user themself can update a profile.
      allow update: if isAdmin() || request.auth.uid == userId;
      
      // No one can create or delete users directly for now.
      allow create, delete: if false;
    }

    match /orders/{orderId} {
      // Only admins can read or write to the orders collection.
      allow read, write: if isAdmin();
    }

    match /settings/{settingId} {
      // Only admins can read or write to the settings collection.
      allow read, write: if isAdmin();
    }
  }
}
